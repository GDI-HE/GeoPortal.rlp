{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% load static i18n humanize %}
{% load static %}
{% block body %}
{% csrf_token %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/update_graph.js' %}"></script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="{% static 'js/check_abstracts.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/check_abstracts.css' %}">
    <title>Service Layer Abstract and Keyword Check</title>
</head>
<body>
    <div class="dashboard">
        <div class="card">
            <h2>{% trans 'Layers Without Abstracts'%}</h2>
            <p class="number">{{ total_layers_without_abstract }}</p>
            <p class="label">{% trans 'Total across all services'%}</p>
        </div>
        <div class="card">
            <h2>{% trans 'Layers Without Keywords' %}</h2>
            <p class="number">{{ total_layers_without_keyword }}</p>
            <p class="label">{% trans 'Total across all services' %}</p>
        </div>
        <div class="card">
            <h2>{% trans 'Abstracts Match Titles' %}</h2>
            <p class="number">{{ total_layers_abstract_matches_title }}</p>
            <p class="label">{% trans 'Total across all services' %}</p>
        </div>
        <div class="card">
            <h2>{% trans 'Layers With Short Abstracts' %}</h2>
            <p class="number">{{ total_layers_with_short_abstract }}</p>
            <p class="label">{% trans 'Total across all services' %}</p>
        </div>
    </div>
   
   <div class="column-toggle-container">
    <button class="column-toggle-button" onclick="toggleColumnList()">
        <i class="fas fa-cog"></i>{% trans 'Columns' %}
    </button>
    <ul class="column-toggle-list" id="columnToggleList">
        <li>
            <label class="switch">
                <input type="checkbox" checked data-column="0">
                <span class="slider round"></span>
            </label>{% trans 'Serial No.' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" checked data-column="1">
                <span class="slider round"></span>
            </label> {% trans 'Service ID' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" checked data-column="2">
                <span class="slider round"></span>
            </label> {% trans 'Service Title' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" checked data-column="3">
                <span class="slider round"></span>
            </label> {% trans 'Total Layers' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" checked data-column="4">
                <span class="slider round"></span>
            </label> {% trans 'Layers Without Abstract' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" checked data-column="5">
                <span class="slider round"></span>
            </label> {% trans 'Layers Without Keywords' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" data-column="6">
                <span class="slider round"></span>
            </label> {% trans 'Abstracts Match Titles' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" data-column="7">
                <span class="slider round"></span>
            </label> {% trans 'Layers With Short Abstracts' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" data-column="8">
                <span class="slider round"></span>
            </label> {% trans 'Data-Service connection' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" data-column="9">
                <span class="slider round"></span>
            </label> {% trans 'Inspire Monitoring Status' %} 
        </li>
        <li>
            <label class="switch">
                <input type="checkbox" data-column="10">
                <span class="slider round"></span>
            </label> {% trans 'ISO Categorized' %} 
        </li>
       
    </ul>
</div>



<!-- Layers Without Keywords Modal -->
<div class="modal fade" id="layersWithoutKeywordsModal" tabindex="-1" role="dialog" aria-labelledby="layersWithoutKeywordsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="layersWithoutKeywordsModalLabel">{% trans 'Layers Without Keywords' %} </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="layersWithoutKeywordsList">
                    <!-- List of layers without keywords will be dynamically generated here -->
                </ul>
                <form id="addKeywordForm">
                    <div class="form-group">
                        <label for="layerId">Layer ID</label>
                        <select class="form-control" id="layerId" name="layer_id">
                            <!-- Options will be dynamically generated here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="keyword">Keyword</label>
                        <input type="text" class="form-control" id="keyword" name="keyword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Keyword</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Layers With Short Abstract Model -->
<div class="modal fade" id="layersWithShortAbstract" tabindex="-1" role="dialog" aria-labelledby="layersWithShortAbstractLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="layersWithoutAbstractsModalLabel">Layers With Short Abstract</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="layersWithoutAbstractsList">
                    <!-- List of layers without abstracts will be dynamically generated here -->
                </ul>
                <form id="addAbstractForm">
                    <div class="form-group">
                        <label for="layerIdAbstract">Layer ID</label>
                        <select class="form-control" id="layerIdAbstract" name="layer_id">
                            <!-- Options will be dynamically generated here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="abstract">Abstract</label>
                        <textarea class="form-control" id="abstract" name="abstract" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Abstract</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="layersWithoutAbstractsModal" tabindex="-1" role="dialog" aria-labelledby="layersWithoutAbstractsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="layersWithoutAbstractsModalLabel">Layers Without Abstracts</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="layersWithoutAbstractsList">

                    <!-- List of layers without abstracts will be dynamically generated here -->
                </ul>
                <form id="addAbstractForm1">
                    <div class="form-group">
                        <label for="layerIdWithoutAbstract">Layer ID</label>
                        <select class="form-control" id="layerIdWithoutAbstract" name="layer_id">
                            <!-- Options will be dynamically generated here -->
                            
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="abstract">Abstract</label>
                        <textarea class="form-control" id="abstract1" name="abstract1" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Abstract</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="layersWithAbstractMatchesTitleModal" tabindex="-1" role="dialog" aria-labelledby="layersWithoutAbstractsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="layersWithAbstractMatchesTitleLabel">Title matches Abstracts</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="layersWithoutAbstractsList">

                    <!-- List of layers without abstracts will be dynamically generated here -->
                </ul>
                <form id="addAbstractForm2">
                    <div class="form-group">
                        <label for="layerIdWithoutAbstract">Layer ID</label>
                        <select class="form-control" id="layerIdAbstractMatchesTitle" name="layer_id">
                            <!-- Options will be dynamically generated here -->
                            
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="abstract">Abstract</label>
                        <textarea class="form-control" id="abstract2" name="abstract2" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Abstract</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="layerLicenseModal" tabindex="-1" role="dialog" aria-labelledby="layerLicenseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="layerLicenseLabel">Edit Fees / License</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="layerLicenseList">

                    <!-- List of layers without abstracts will be dynamically generated here -->
                </ul>
                <form id="addAbstractForm3">
                    <div class="form-group">
                        <label for="layerIdWithoutAbstract">Layer ID</label>
                        <select class="form-control" id="showLicense" name="layer_id">
                            <!-- Options will be dynamically generated here -->
                            
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="abstract">License</label>
                        <textarea class="form-control" id="layer_license" name="layer_license" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Abstract</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="layerConstraintModal" tabindex="-1" role="dialog" aria-labelledby="layerConstraintModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="layerConstraintLabel">Edit Constraint</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="layerConstraintList">

                    <!-- List of layers without abstracts will be dynamically generated here -->
                </ul>
                <form id="addConstraintForm3">
                    <div class="form-group">
                        <label for="layerIdWithoutAbstract">Layer ID</label>
                        <select class="form-control" id="showConstraint" name="layer_id">
                            <!-- Options will be dynamically generated here -->
                            
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="abstract">Constraint</label>
                        <textarea class="form-control" id="layer_constraint" name="layer_constraint" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Abstract</button>
                </form>
            </div>
        </div>
    </div>
</div>


<script src="{% static 'js/bootstrap_1.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/bootstrap_1.min.css' %}">


    <table id="serviceTable">
        <thead>
            <tr>
                <th>{% trans 'Serial No.' %} </th>
                <th>{% trans 'Service ID' %} </th>
                <th>{% trans 'Service Title' %} </th>
                <th>{% trans 'Total Layers' %} </th>
                <th>{% trans 'Layers Without Abstracts'%}</th>
                <th>{% trans 'Layers Without Keywords' %}</th>
                <th style="display: none;">{% trans 'Abstracts Match Titles' %}</th>
                <th style="display: none;">{% trans 'Layer With Short Abstract' %}</th>
                <th style="display: none;">{% trans 'Data-Service connection' %}</th>
                <th style="display: none;">{% trans 'Inspire Monitoring Status' %}
                    <div class="tooltip-wrapper">
                        <button 
                          id="tooltip-trigger" 
                          class="btn btn-info" 
                          aria-describedby="tooltip-content">
                          <i class="fas fa-info-circle"></i>
                        </button>
                        <div id="tooltip-content" class="custom-tooltip" tabindex="-1" role="tooltip">
                          <div class="tooltip-item">
                            <span class="tooltip-icon white-icon"></span>
                            <span>{% trans 'No Inspire Category, nor Inspireidentifiziert' %}</span>
                          </div>
                          <div class="tooltip-item">
                            <span class="tooltip-icon mild-red-icon"></span>
                            <span>{% trans 'Inspire Category but keyword missing' %}</span>
                          </div>
                          <div class="tooltip-item">
                            <span class="tooltip-icon dark-red-icon"></span>
                            <span>{% trans 'Keyword as Inspireidentifiziert but Inspire category missing' %}</span>
                          </div>
                          <div class="tooltip-item">
                            <span class="tooltip-icon green-icon"></span>
                            <span>{% trans 'Both Inspire Category and Inspireidentifiziert' %}</span>
                          </div>
                        </div>
                      </div>
                      
                      
                </th>
                <th style="display: none;">{% trans 'ISO Categorized' %}</th>

                <th>{% trans 'Actions' %}</th>
               
            </tr>
        </thead>
     
        <tbody>
            {% for result in results %}
               <div class="spinner" id="spinner"></div>
                <tr class="main-row {% if result.layers_with_comma_keywords %}{% endif %}">
                <td data-label="Serial No.">{{ forloop.counter }}</td>
                <td data-label="Service ID">{{ result.wms_id }}</td>
                <td data-label="Service Title">{{ result.wms_title }}</td>
                <td data-label="Total Layers">{{ result.total_layers }}</td>

                <td data-label="Layers without Abstract">
                   {% if result.layers_without_abstract %}
                    <i class="fas fa-circle red-dot">✖</i>
                    {% else %}
                    <i class="fas fa-circle green-dot">✔</i>
                    {% endif %} 
                    <!-- {{ result.layers_without_abstract }} -->
                
                </td>
                <td data-label="Layers without Keywords">
                   {% if result.layers_without_keywords %}
                   <i class="fas fa-circle red-dot">✖</i>
                    {% else %}
                    <i class="fas fa-circle green-dot">✔</i>
                    {% endif %} 
                    
                    <!-- {{ result.layers_without_keywords }} -->
                </td>
                <td data-label="Layers title matches Abstract" style="display: none;">
                    {% for match in result.layers_abstract_match %}
                   {% if match == 'Y' %} 
                   <i class="fas fa-circle red-dot">✖</i>
                     {% elif match == 'N' and match != 'Y' %}
                        <i class="fas fa-circle green-dot">✔</i>
                    {% endif %} 
                    {% endfor %}
                </td>
                <td data-label="Layers with short Abstract" style="display: none;">
                   {% if result.layers_with_short_abstract_count > 0 %}
                    <i class="fas fa-circle red-dot">✖</i>
                    {% else %} 
                    <i class="fas fa-circle green-dot">✔</i>
                    {% endif %}
                    <!-- {{ result.layers_with_short_abstract_count }} -->
                </td>
                <td data-label="Data-Service Connection" style="display: none;">
                    {% if result.connected_wms %}
                        <i class="fas fa-circle green-dot">✔</i>
                    {% else %}
                        <i class="fas fa-circle red-dot">✖</i>
                    {% endif %}
                </td>
                <td data-label="Inspire Category" style="display: none;">
                    {% if result.color == 'white' %}
                        <i class="fas fa-circle white-dot"></i>
                    {% elif result.color == 'green' %}
                        <i class="fas fa-circle green-dot">✔</i>
                    {% elif result.color == 'mildred' %}
                        <i class="fas fa-circle mildred-dot">✖</i>
                    {% else %}
                        <i class="fas fa-circle mildred1-dot">✖</i>
                    {% endif %}
                </td>
                <td data-label="ISO category" style="display: none;">
                    {% if result.color_iso == 'white-iso' %}
                    <i class="fas fa-circle white-dot"></i>
                    {% else %}
                    <i class="fas fa-circle green-dot">✔</i>
                    {{ result.category }}
                   {% endif %} 
                  
                </td>
                <td data-label="Actions">
                    <button class="dropdown-btn" onclick="toggleDropdown(this)">{% trans 'Show Details' %} </button>
                </td>
                
                  
                
            </tr>
            <tr class="details-section">
                <td colspan="12">
                    <div class="dropdown-container">
                    <div class="dropdown">
                        <div class="dropdown-title">
                            {% trans 'Keywords Present' %}
                           {% if result.keywords_present %} 
                            <i class="fas fa-info-circle"></i>
                           {% else %}
                            <i class="fas fa-info-circle red-icon"></i>
                        {% endif %}
                    </div>
                        <div class="dropdown-content">
                            <ul>
                                {% for keyword in result.keywords_present %}
                                <li>{{ keyword }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">{% trans 'Abstracts Present' %} <i class="fas fa-info-circle"></i></div>
                        <div class="dropdown-content">
                            <ul>
                                {% for abstract in result.abstracts_present %}
                                <li>{{ abstract }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">{% trans 'Layers Without Abstracts' %} 
                           {% if result.layers_without_abstract_names %} 
                            <i class="fas fa-info-circle red-icon"></i>
                            {% else %}
                            <i class="fas fa-info-circle"></i>
                        {% endif %}
                        </div>
                        <div class="dropdown-content">
                            <ul>
                                {% for layer_name in result.layers_without_abstract_names %}
                                <li>{{ layer_name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">
                            {% trans 'Layers Without Keywords' %} 
                           {% if result.layers_without_keyword_names %} 
                            <i class="fas fa-info-circle red-icon"></i>
                           {% else %}
                            <i class="fas fa-info-circle"></i> 
                        {% endif %}
                        </div>
                        <div class="dropdown-content">
                            <ul>
                                {% for layer_name in result.layers_without_keyword_names %}
                                <li>{{ layer_name }}</li>
                                
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">
                            {% trans 'Layers Where Abstract Matches Title' %} 
                           {% if result.layers_abstract_matches_title_names %} 
                            <i class="fas fa-info-circle red-icon"></i>
                           {% else %}
                            <i class="fas fa-info-circle"></i>
                        {% endif %}
                        </div>
                        <div class="dropdown-content">
                            <ul>
                                {% for layer_name in result.layers_abstract_matches_title_names %}
                                <li>{{ layer_name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">{% trans 'Layer Names' %} <i class="fas fa-info-circle"></i></div>
                        <div class="dropdown-content">
                            <ul>
                                {% for layer_name in result.layer_names %}
                                <li>{{ layer_name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">
                            {% trans 'Layers With Short Abstracts' %}
                           {%if result.layers_with_short_abstract_info %} 
                            <i class="fas fa-info-circle red-icon"></i>
                            {% else %}
                            <i class="fas fa-info-circle"></i>
                        {% endif %}
                        </div>
                        <div class="dropdown-content">
                            <ul>
                                {% for layer_name, layer_abstract in result.layers_with_short_abstract_info %}
                                <li class="short-abstract">{{ layer_name }}: {{ layer_abstract }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">
                            {% trans 'Information on costs/fees/licenses' %} 
                           {% if result.wms_fees|length > 5 %} 
                            <i class="fas fa-info-circle"></i>
                           {% else %}
                            <i class="fas fa-info-circle red-icon"></i> 
                        {% endif %}
                        </div>
                        <div class="dropdown-content">
                            <ul>{{ result.wms_fees }}</ul>
                        </div>
                    </div>
                    <div class="dropdown">
                        <div class="dropdown-title">
                            {% trans 'Restrictions on public access' %} 
                            {% if result.wms_accessconstraints|length > 5 %}
                            <i class="fas fa-info-circle"></i>
                            {% else %}
                            <i class="fas fa-info-circle red-icon"></i>
                        {% endif %}
                        </div>
                        <div class="dropdown-content">
                            <ul>{{ result.wms_accessconstraints }}</ul>
                        </div>
                    </div>
                </div>
                </td>
            </tr>
            {% endfor %}
    </table>
    <button id="load-more" class="load-more-btn" style="display: none;">Load More</button>
    
    <script>
             let serialNo = {{ results|length }}; // Start serial number from the current number of results
    </script>
</body>
{% endblock %}